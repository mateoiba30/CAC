PIC EQU 20H; EOI IMR IRR ISR INT0 (F10)
TIMER EQU 10H;CONT COMP
N_F10 EQU 10
N_CLK EQU 20

ORG 40
IP_F10 DW RUT_F10

ORG 80
IP_CLK DW RUT_CLK

ORG 1000H
DSEG DB 30H
USEG DB 30H
ESPACIO DB " "

ORG 3000H

RUT_CLK:PUSH AX;MUESTRO SEGS, INC SEGS, REINICIO CONT, FIN

MOV BX, OFFSET DSEG
MOV AL,3
INT 7

INC USEG
CMP USEG,3AH
JNZ SALTO1
MOV USEG,30H
INC DSEG

SALTO1:MOV AL,0
OUT TIMER,AL
MOV AL,20H
OUT PIC,AL
POP AX
IRET

RUT_F10:PUSH AX;ACTIVO/DESACTIVO TIMER
IN AL,PIC+1;OBTENGO EL ESTADO DEL IMR
CMP AL,11111110B
JNZ SALTO;SI EL TIMER NO EST√Å ENMASCARADO
AND AL,11111100B
JMP IMR
SALTO:OR AL,00000010B
IMR:OUT PIC+1,AL
MOV AL,20H
OUT PIC,AL
POP AX
IRET

CONF_PIC:PUSH AX
MOV AL,11111110B;USO TIMER Y F10, PERO F10 ACTIVA AL TIMER
OUT PIC+1,AL
MOV AL,N_F10
OUT PIC+4,AL
MOV AL,N_CLK
OUT PIC+5,AL
POP AX
RET

CONF_CLK:PUSH AX
MOV AL,0
OUT TIMER,AL
MOV AL,1
OUT TIMER+1,AL
POP AX
RET

ORG 2000H
CLI
CALL CONF_PIC;IMR Y RUTINAS DE INT0 Y INT1
CALL CONF_CLK;REGISTROS TIMER
STI

ESPERAR:CMP DSEG,33H;SI LLEGO A LOS 30 SEG TERMINO
JNZ ESPERAR

INT 0
END