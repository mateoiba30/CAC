HAND EQU 40H;DATOS ESTADO
;PARTE B, HAND POR POLLING (CHEQUEO BUSY, NO HAY PIC, STROBE AUTOMATICO)

ORG 1000H
CARS DB "?????"
FIN DB ?

ORG 3000H

RUT_HND:PUSH CX
PUSH BX

POLL:IN AL,HAND+1;ENVIO DATOS
AND AL,1
JNZ POLL
MOV AL,[BX]
OUT HAND,AL
INC BX
DEC CL
JNZ POLL

MOV CL, OFFSET FIN - OFFSET CARS;REINICIO CONTADOR
DEC BX;BX APUNTA LA ULTIMO AHORA
POLL2:IN AL,HAND+1;AHORA SIMILAR, PERO EN REVERSA
AND AL,1
JNZ POLL2
MOV AL,[BX]
OUT HAND,AL
DEC BX
DEC CL
JNZ POLL2

POP BX;FIN
POP CX
RET

DESHAB_INT:PUSH AX
IN AL,HAND+1
AND AL,01111111B
OUT HAND+1,AL
POP AX
RET

LEER_CARS:PUSH BX
PUSH CX
REP:INT 6
INC BX
DEC CL
JNZ REP
POP CX
POP BX
RET

ORG 2000H
MOV BX,OFFSET CARS
MOV CL, OFFSET FIN - OFFSET CARS
CALL DESHAB_INT
CALL LEER_CARS
CALL RUT_HND
INT 0
END