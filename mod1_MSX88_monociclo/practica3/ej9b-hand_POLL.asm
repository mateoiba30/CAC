HAND EQU 40H;defino etiquetas
;HAND SHAKE EMITE UNA INTERRUPCION CUANDO LA IMPRESORA SE DESOCUPA, NO ESTA BUSY

ORG 1000H
NUMS DB "?????"
FIN DB ?

ORG 3000H 

RUT_HND:PUSH AX
CMP CH,0
JNZ REVERSA

MOV AL,[BX]
INC BX
OUT HAND,AL
DEC CL

CMP CL,0
JNZ FIN2
DEC BX;BX SE HAB√çA PASADO POR 1 CARACTER
NOT CH;INDICO CAMBIO DEL RECORRIDO
MOV CL, OFFSET FIN - OFFSET NUMS;reinicio contador para ir en reversa
JMP FIN2

REVERSA:MOV AL,[BX];BX YA APUNTA AL FINAL
DEC BX
OUT HAND, AL
DEC CL

FIN2:POP AX
RET

LEER_CARACTERES:PUSH BX
PUSH DX

MOV DL,0
MOV BX, OFFSET NUMS
REP:INT 6
INC BX
INC DL
CMP DL,CL
JNZ REP

POP DX
POP BX
RET

ORG 2000H
MOV CL, OFFSET FIN - OFFSET NUMS;CONTADOR DE CARACTERES
MOV BX, OFFSET NUMS
CALL LEER_CARACTERES

POLL:IN AL,HAND+1
AND AL,1
JNZ POLL
CALL RUT_HND
CMP CL,0
JNZ POLL

INT 0
END